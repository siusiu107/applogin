<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>기기 코드 로그인</title>

  <!-- Firebase compat SDK (v9) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <style>
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0f172a;
      color: #f9fafb;
      padding: 16px;
      box-sizing: border-box;
    }
    .card {
      width: 100%;
      max-width: 420px;
      background: rgba(15,23,42,0.95);
      border-radius: 16px;
      box-shadow: 0 24px 80px rgba(15,23,42,0.8);
      padding: 24px 20px 20px;
    }
    h1 {
      margin: 0 0 8px;
      font-size: 1.4rem;
    }
    p {
      margin: 4px 0 12px;
      font-size: 0.9rem;
      color: #e5e7eb;
    }
    input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #f9fafb;
      font-size: 1rem;
      box-sizing: border-box;
      margin: 4px 0 12px;
    }
    input::placeholder {
      color: #6b7280;
    }
    button {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      background: linear-gradient(135deg, #10b981, #22c55e);
      color: #022c22;
      margin-top: 4px;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    #status {
      margin-top: 10px;
      font-size: 0.85rem;
      color: #9ca3af;
      min-height: 1.2em;
    }
    .code-hint {
      display: inline-block;
      background: rgba(15,118,110,0.2);
      color: #6ee7b7;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>기기 로그인</h1>
    <p class="code-hint">앱에 표시된 6자리 코드를 입력하세요.</p>
    <p>휴대폰 앱(또는 게임) 화면에 보이는 코드를 아래에 입력한 후, 구글 계정으로 로그인하면 기기가 연결됩니다.</p>

    <input id="codeInput" placeholder="예: AB4F92" maxlength="8" autocomplete="off" />
    <button id="btnGoogleLogin">코드로 구글 로그인</button>
    <p id="status"></p>
  </div>

  <script>
    // TODO: 여기에 실제 Firebase 웹 설정을 넣으세요.
    // (게임에서 사용 중인 firebaseConfig와 동일하게 맞추면 됩니다.)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };
    firebase.initializeApp(firebaseConfig);

    const provider = new firebase.auth.GoogleAuthProvider();

    const codeInput = document.getElementById('codeInput');
    const btn = document.getElementById('btnGoogleLogin');
    const statusEl = document.getElementById('status');

    function setStatus(msg) {
      statusEl.textContent = msg;
    }

    btn.addEventListener('click', async () => {
      const rawCode = codeInput.value.trim();
      if (!rawCode) {
        alert('코드를 입력하세요.');
        return;
      }
      const code = rawCode.toUpperCase();

      btn.disabled = true;
      setStatus('구글 로그인 창을 여는 중입니다...');

      try {
        const result = await firebase.auth().signInWithPopup(provider);
        const user = result.user;
        const idToken = await user.getIdToken();

        setStatus('서버에 로그인 정보를 보내는 중입니다...');

        const res = await fetch('/api/login-complete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code, idToken }),
        });

        const data = await res.json();
        if (res.ok) {
          setStatus('로그인이 완료되었습니다. 앱으로 돌아가면 자동으로 연결됩니다.');
        } else {
          console.error(data);
          setStatus('오류: ' + (data.error || '알 수 없는 오류'));
        }
      } catch (err) {
        console.error(err);
        setStatus('로그인 중 오류가 발생했습니다. 다시 시도해 주세요.');
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
